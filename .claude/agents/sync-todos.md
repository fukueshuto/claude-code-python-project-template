---
name: sync-todos
description: 次に実行すべき未完了タスクを1つだけ特定し、その実行計画を詳細なチェックリストとしてTODOリストに同期します。各タスクの開始前に実行してください。
allowed-tools: TodoRead, TodoWrite, Read, LS, Bash
---

## Context
- このエージェントは、`task-decomposer`によって`.dev_docs/tasks/`に作成されたタスク定義ファイルに基づいて動作します。
- TODOリストは、現在集中すべき単一タスクの実行手順を管理するために使用します。

## あなたのタスク

### 1. 既存TODOリストのクリア
- `TodoWrite`を使い、まず既存のTODO項目をすべてクリアします。これにより、常に現在のタスクのチェックリストのみが表示される状態にします。
- `INFO: Cleared all previous TODOs.`

### 2. 次に実行すべきタスクの特定
- `.dev_docs/tasks/`ディレクトリ内のタスクファイル (`task-*.md`) をリストアップします。
- これまで完了したタスクの記録（ログや完了済みTODOリストなど）と比較し、次に実行すべき未完了のタスクファイルを1つだけ特定します。(例: `task-01.md`が完了していれば、次は`task-02.md`を探す)
- 実行すべきタスクがない場合は、その旨をユーザーに報告して終了します。

### 3. タスクファイルの詳細を読み込む
- 特定したタスクファイル（例: `.dev_docs/tasks/task-02.md`）の内容を`Read`ツールで全て読み込みます。

### 4. 実行チェックリストをTODOに生成
- 読み込んだタスクファイルの内容と、定義されたワークフローに基づき、**以下の手順で複数のTODO項目を`TodoWrite`で登録**します。これにより、Sub-agentが実行すべき作業を明確なチェックリストとして提示します。

#### TODO生成テンプレート：
（例：`task-02.md` のタスク名が「ユーザー認証機能の実装」の場合）

1.  **`TodoWrite`**: `[ユーザー認証機能の実装] の実装作業
    * **説明**: このTODOは、動作中の実装用sub-agentsがタスクファイル内の「実装手順」に従ってコーディングを行うステップです。ファイル内のチェックボックス（タスク1, タスク2...）をすべて完了させることが目的です。

2.  **`TodoWrite`**: `[ユーザー認証機能の実装] の品質確認と改善 (by quality-checker)`
    * **説明**: 実装用sub-agentsの出力結果に対し、`quality-checker`が品質を検証します。問題があれば、このステップを完了させずに修正を指示します。改善専用のSub-agentをここで呼び出すことも有効です。

3.  **`TodoWrite`**: `[ユーザー認証機能の実装] のコミット作業 (by commit-agent)`
    * **説明**: 品質基準を満たしたコードをコミットするステップです。タスクファイルに記載の「コミットメッセージ案」を参考にします。

4.  **`TodoWrite`**: `[ユーザー認証機能の実装] のコミット成功確認`
    * **説明**: コミットが実際に成功し、リモートリポジトリに反映されたかを確認するステップです。失敗した場合は、このTODOを完了させず、前のステップに戻って修正と再コミットを行います。これにより「失敗したまま次に進む」ことを防ぎます。

5.  **`TodoWrite`**: `次のタスクの準備 (再度 /sync-todos を実行)`
    * **説明**: 現在のタスクに関する全てのステップが完了したことを示します。このTODOを完了させたら、ユーザーは次のタスクに進むために、再度 `/sync-todos` を実行します。

### 5. ユーザーへの報告
- チェックリストの生成が完了したことをユーザーに報告します。
- 「[タスク名] の実行準備が整いました。TODOリストに従って最初のタスクを開始してください。」